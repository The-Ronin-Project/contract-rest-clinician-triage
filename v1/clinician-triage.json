{
  "openapi": "3.0.0",
  "info": {
    "title": "Clinician Triage Service Contract",
    "description": "API contract for the Clinician Triage Service",
    "version": "1.0.0",
    "contact": {
      "name": "David Dionise",
      "url": "(coming)",
      "email": "ddionise@projectronin.com"
    }
  },
  "servers": [
    {
      "url": "/api/v1"
    }
  ],
  "tags": [
    {
      "name": "Care Team Response",
      "description": "Endpoints for creating and updating clinitian communication"
    },
    {
      "name": "Reported Symptoms",
      "description": "Endpoints related to fetching the patient's reported symptoms"
    }
  ],
  "paths": {
    "/add_care_team_response/{patientId}": {
      "post": {
        "deprecated": true,
        "tags": [
          "Care Team Response"
        ],
        "description": "Create a care team response for the associated patient",
        "summary": "Create Care Team Response",
        "operationId": "addCareTeamResponseDEPRECATED",
        "parameters": [
          {
            "name": "patientId",
            "in": "path",
            "required": true,
            "example": "10253",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "survey_response_id"
                ],
                "properties": {
                  "survey_response_id": {
                    "type": "integer"
                  },
                  "status": {
                    "type": "string"
                  },
                  "custom_comment": {
                    "type": "string"
                  },
                  "comment": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "survey_response_id": 1025,
                "status": "address_at_next",
                "custom_comment": "Go do a thing",
                "comment": "I instructed the patient to do a thing"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful create/update of care team response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    }
                  }
                },
                "examples": {
                  "CareTeamResponseExample": {
                    "$ref": "#/components/examples/CareTeamResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/sign_care_team_response/{patientId}": {
      "patch": {
        "deprecated": true,
        "tags": [
          "Care Team Response"
        ],
        "description": "Sign a care team response for the associated patient",
        "summary": "Sign Care Team Response",
        "operationId": "signCareTeamResponseDEPRECATED",
        "parameters": [
          {
            "name": "patientId",
            "in": "path",
            "required": true,
            "example": "10352",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "survey_response_id"
                ],
                "properties": {
                  "survey_response_id": {
                    "type": "integer"
                  },
                  "comment": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "survey_response_id": 1025,
                "comment": "I instructed the patient to do a thing"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful signing of care team response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    }
                  }
                },
                "examples": {
                  "CareTeamResponseExample": {
                    "$ref": "#/components/examples/CareTeamResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/care_team_response/{surveyResponseId}": {
      "put": {
        "tags": [
          "Care Team Response"
        ],
        "description": "Create/update a care team response for the associated survey response",
        "summary": "Create/Update Care Team Response",
        "operationId": "saveCareTeamResponse",
        "parameters": [
          {
            "name": "surveyResponseId",
            "in": "path",
            "required": true,
            "example": "543346",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "option"
                ],
                "properties": {
                  "option": {
                    "type": "string"
                  },
                  "comment": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "option": "schedule_visit",
                "comment": "You should get in to see the doctor this week"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful create of care team response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    }
                  }
                },
                "examples": {
                  "CareTeamResponseExample": {
                    "$ref": "#/components/examples/CareTeamResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/care_team_response/{surveyResponseId}/draft": {
      "put": {
        "tags": [
          "Care Team Response"
        ],
        "summary": "Create/update Care Team Response Draft",
        "description": "Create/Update a care team response draft for the associated survey response",
        "operationId": "saveCareTeamResponseDraft",
        "parameters": [
          {
            "name": "surveyResponseId",
            "in": "path",
            "required": true,
            "example": "543346",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "option"
                ],
                "properties": {
                  "option": {
                    "type": "string"
                  },
                  "comment": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "option": "schedule_visit",
                "comment": "You should get in to see the doctor this week"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful create of care team response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    }
                  }
                },
                "examples": {
                  "CareTeamResponseExample": {
                    "$ref": "#/components/examples/CareTeamResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/care_team_response/{surveyResponseId}/sign": {
      "patch": {
        "tags": [
          "Care Team Response"
        ],
        "summary": "Sign Care Team Response",
        "description": "Sign a care team response for the associated survey response. May include an optional internal note",
        "operationId": "signCareTeamResponse",
        "parameters": [
          {
            "name": "surveyResponseId",
            "in": "path",
            "required": true,
            "example": "543346",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "internal_note": {
                    "type": "string"
                  }
                }
              },
              "example": {
                "internal_note": "Patient needs blood drawn"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful signing of care team response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    }
                  }
                },
                "examples": {
                  "CareTeamResponseExample": {
                    "$ref": "#/components/examples/CareTeamResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/patient_reported_symptoms/{patientId}": {
      "get": {
        "tags": [
          "Reported Symptoms"
        ],
        "summary": "Get Patient Reported Symptoms",
        "description": "Get all reported symptoms and response options for a patient",
        "operationId": "getPatientReportedSymptoms",
        "parameters": [
          {
            "name": "patientId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful fetch of symptoms",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "meta": {
                      "type": "object",
                      "properties": {
                        "links": {
                          "type": "object",
                          "properties": {
                            "self": {
                              "type": "string",
                              "description": "Link to the path of the request"
                            }
                          }
                        }
                      }
                    },
                    "data": {
                      "$ref": "#/components/schemas/QuestionnaireResponse"
                    }
                  }
                },
                "examples": {
                  "QuestionnaireResponseExample": {
                    "$ref": "#/components/examples/QuestionnaireResponseExample"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request"
          },
          "404": {
            "description": "Resource not found"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    }
  },
  "components": {
    "examples": {
      "QuestionnaireResponseExample": {
        "summary": "Questionnaire Response Example",
        "value": {
          "meta": {
            "links": {
              "self": "/v1/patient_reported_symptoms/23232"
            }
          },
          "data": {
            "permissions": {
              "allowed_responses": {
                "contact_patient": "Contact Patient",
                "monitor_at_home": "Monitor at Home",
                "patient_contacted_us": "Patient Contacted Us",
                "schedule_visit": "Schedule Visit",
                "send_to_ed": "Send to ED"
              },
              "write_enabled": true
            },
            "symptoms": {
              "survey_responses": [
                {
                  "id": 918943,
                  "is_alerted": true,
                  "alert_tier": {
                    "tier": 2,
                    "triage_dash_tag": "Urgent Response Required",
                    "triage_dash_label": "Patient told to call 911"
                  },
                  "care_team_response": {
                    "id": 10256,
                    "status": "schedule_visit",
                    "display_status": "Schedule Visit",
                    "custom_comment": "You should get in to see the doctor this week",
                    "comment": "Patient needs blood drawn",
                    "patient_message": {
                      "option": "schedule_visit",
                      "display": "Schedule Visit",
                      "comment": "You should get in to see the doctor this week"
                    },
                    "internal_note": "Patient needs blood drawn",
                    "responder": {
                      "id": 28639,
                      "name": "Charles Henri",
                      "created_at": "2022-01-09T03:08:01.123Z",
                      "updated_at": "2022-02-16T04:28:45.723Z"
                    },
                    "read_at": "2023-01-12T09:48:54.826Z",
                    "signed_at": "2023-01-12T07:23:13.837Z",
                    "created_at": "2023-01-12T07:23:13.837Z",
                    "updated_at": "2023-01-12T07:23:13.837Z"
                  },
                  "survey_id": 24643,
                  "category_severe_symptoms_map": {
                    "Diarrhea": [
                      {
                        "id": 88469,
                        "answer_id": 127326,
                        "category_id": 63,
                        "name": "Frequency: Occasionally",
                        "severity": "Mild/Moderate",
                        "survey_response_id": 15522,
                        "value": "2",
                        "created_at": "2022-12-02T19:52:45.000Z",
                        "updated_at": "2022-12-02T19:52:45.000Z"
                      },
                      {
                        "id": 88470,
                        "answer_id": 127327,
                        "category_id": 63,
                        "name": "Daily episodes at worst: 2-3",
                        "severity": "Mild/Moderate",
                        "survey_response_id": 15522,
                        "value": "2",
                        "created_at": "2022-12-02T19:52:45.000Z",
                        "updated_at": "2022-12-02T19:52:45.000Z"
                      }
                    ]
                  },
                  "categories_without_severe_symptoms_map": {
                    "Vomiting": [
                      {
                        "id": 88442,
                        "answer_id": 127288,
                        "category_id": 69,
                        "name": "[Vomiting] Present: No",
                        "survey_response_id": 15518,
                        "value": "0",
                        "created_at": "2022-12-02T19:26:48.000Z",
                        "updated_at": "2022-12-02T19:26:48.000Z"
                      }
                    ]
                  },
                  "symptoms": {
                    "severe": {
                      "Diarrhea": [
                        {
                          "id": 88469,
                          "answer_id": 127326,
                          "category_id": 63,
                          "name": "Frequency: Occasionally",
                          "severity": "Mild/Moderate",
                          "survey_response_id": 15522,
                          "value": "2",
                          "created_at": "2022-12-02T19:52:45.000Z",
                          "updated_at": "2022-12-02T19:52:45.000Z"
                        },
                        {
                          "id": 88470,
                          "answer_id": 127327,
                          "category_id": 63,
                          "name": "Daily episodes at worst: 2-3",
                          "severity": "Mild/Moderate",
                          "survey_response_id": 15522,
                          "value": "2",
                          "created_at": "2022-12-02T19:52:45.000Z",
                          "updated_at": "2022-12-02T19:52:45.000Z"
                        }
                      ]
                    },
                    "non_severe": {
                      "Vomiting": [
                        {
                          "id": 88442,
                          "answer_id": 127288,
                          "category_id": 69,
                          "name": "[Vomiting] Present: No",
                          "survey_response_id": 15518,
                          "value": "0",
                          "created_at": "2022-12-02T19:26:48.000Z",
                          "updated_at": "2022-12-02T19:26:48.000Z"
                        }
                      ]
                    }
                  },
                  "write_in": "Vomiting has gotten better",
                  "symptom_educations": [
                    {
                      "body": "\r\n**Nausea is a common side effect of cancer treatment that may lead to vomiting**  \r\n\r\n**Medicine**\r\n\r\n* If your care team gave you nausea medicines (antiemetics), follow the instructions on how to take them  \r\n\r\n**Food/Fluids**\r\n\r\n* Eat small meals often to keep something in your stomach\r\n\r\n* Eat dry foods (such as crackers or toast) when you wake up, before you start to move around\r\n\r\n* It is important to stay hydrated. Drink 64 to 80 ounces of fluids per day. Fluids include clear soups, flavored gelatin, carbonated drinks, popsicles, tea and ice chips made of any kind of liquid.\r\n\r\n* Sip room temperature carbonated drinks such as cola or ginger ale\r\n\r\n* Try tart or sour flavored foods, hard candies or liquids\r\n\r\n**Other Tips**\r\n\r\n* Apply a cool wet cloth to your forehead or neck\r\n\r\n* Open a window or use a fan to feel fresh air movement\r\n\r\n",
                      "category": {
                        "name": "Nausea"
                      },
                      "external_links": [
                        {
                          "title": "Patient Education Nausea and Vomiting",
                          "url": "https://www.mdanderson.org/patient-education/Nutrition/Nausea-and-Vomiting-Tips-for-Coping.pdf"
                        }
                      ]
                    }
                  ],
                  "created_at": "2022-12-02T13:57:12.765Z",
                  "completed_on": "2022-12-02T19:26:48.000Z"
                }
              ]
            }
          }
        }
      },
      "CareTeamResponseExample": {
        "summary": "Care Team Response Example",
        "value": {
          "meta": {
            "links": {
              "self": "/v1/care_team_response/10256"
            }
          },
          "data": {
            "id": 10256,
            "status": "schedule_visit",
            "display_status": "Schedule Visit",
            "custom_comment": "You should get in to see the doctor this week",
            "comment": "Patient needs blood drawn",
            "patient_message": {
              "option": "schedule_visit",
              "display": "Schedule Visit",
              "comment": "You should get in to see the doctor this week"
            },
            "internal_note": "Patient needs blood drawn",
            "responder": {
              "id": 28639,
              "name": "Charles Henri",
              "created_at": "2022-01-09T03:08:01.123Z",
              "updated_at": "2022-02-16T04:28:45.723Z"
            },
            "read_at": "2023-01-12T09:48:54.826Z",
            "signed_at": "2023-01-12T07:23:13.837Z",
            "created_at": "2023-01-12T07:23:13.837Z",
            "updated_at": "2023-01-12T07:23:13.837Z"
          }
        }
      }
    },
    "schemas": {
      "Responder": {
        "type": "object",
        "properties": {
          "id": {
            "type": "number"
          },
          "name": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CareTeamResponse": {
        "description": "Data pertaining to the messages that clinicians send to the patients, and notes that are stored for internal use",
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "deprecated": true,
            "description": "(See `patient_message -> value`). Required if `patient_message -> value` is `null`"
          },
          "display_status": {
            "type": "string",
            "deprecated": true,
            "description": "(See `patient_message -> display`). Required if `patient_message -> display` is `null`",
            "nullable": true
          },
          "custom_comment": {
            "type": "string",
            "deprecated": true,
            "description": "(See `patient_message -> comment`)",
            "nullable": true
          },
          "comment": {
            "type": "string",
            "deprecated": true,
            "description": "(See `internal_note`)"
          },
          "patient_message": {
            "type": "object",
            "properties": {
              "option": {
                "type": "string",
                "description": "Message sent from the clinician to the patient. Chosen from a set number of options. Required if `status` is `null`"
              },
              "display": {
                "type": "string",
                "description": "The display value of the `patient_message -> option` enum. Required if `display_status` is `null`",
                "nullable": true
              },
              "comment": {
                "type": "string",
                "description": "Custom comment sent to patient from the clinician",
                "nullable": true
              }
            }
          },
          "internal_note": {
            "type": "string",
            "description": "Optional note that the clinician can store for internal use",
            "nullable": true
          },
          "responder": {
            "$ref": "#/components/schemas/Responder"
          },
          "signed_at": {
            "type": "string",
            "format": "date-time",
            "description": "The date/time that the clinician signed the communication with the customer (if it was signed)",
            "nullable": true
          },
          "read_at": {
            "type": "string",
            "format": "date-time",
            "description": "The date/time that the patient read the response",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SymptomResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "answer_id": {
            "type": "integer"
          },
          "category_id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "severity": {
            "type": "string"
          },
          "survey_response_id": {
            "type": "integer"
          },
          "value": {
            "type": "string"
          }
        }
      },
      "AlertTier": {
        "type": "object",
        "properties": {
          "tier": {
            "type": "number"
          },
          "triage_dash_tag": {
            "type": "string"
          },
          "triage_dash_label": {
            "type": "string"
          },
          "triage_dash_label_icon": {
            "type": "string"
          }
        }
      },
      "SymptomEducation": {
        "type": "object",
        "properties": {
          "category": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              }
            }
          },
          "body": {
            "type": "string",
            "description": "String containing the symptome education"
          },
          "external_links": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "url": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "QuestionnaireResponse": {
        "type": "object",
        "properties": {
          "permissions": {
            "type": "object",
            "properties": {
              "writeEnabled": {
                "type": "boolean"
              },
              "allowedResponses": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "symptoms": {
            "type": "object",
            "properties": {
              "survey_responses": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "is_alerted": {
                      "type": "boolean",
                      "description": "Whether the symptoms reported by the patient triggered an alert"
                    },
                    "alert_tier": {
                      "$ref": "#/components/schemas/AlertTier"
                    },
                    "care_team_response": {
                      "$ref": "#/components/schemas/CareTeamResponse"
                    },
                    "survey_id": {
                      "type": "integer",
                      "description": "The ID of the survey taken by the patient"
                    },
                    "category_severe_symptoms_map": {
                      "type": "object",
                      "deprecated": true,
                      "description": "Replaced with `symptoms -> severe`",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/SymptomResponse"
                        }
                      }
                    },
                    "categories_without_severe_symptoms_map": {
                      "type": "object",
                      "deprecated": true,
                      "description": "Replaced with `symptoms -> non_severe`",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/SymptomResponse"
                        }
                      }
                    },
                    "symptoms": {
                      "type": "object",
                      "description": "The symptoms reported by the patient via the phone app",
                      "properties": {
                        "severe": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "array",
                            "items": {
                              "$ref": "#/components/schemas/SymptomResponse"
                            }
                          }
                        },
                        "non_severe": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "array",
                            "items": {
                              "$ref": "#/components/schemas/SymptomResponse"
                            }
                          }
                        }
                      }
                    },
                    "write_in": {
                      "type": "string",
                      "description": "Custom string entered by the patient while reporting symptoms",
                      "nullable": true
                    },
                    "symptom_educations": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SymptomEducation"
                      },
                      "nullable": true
                    },
                    "completed_on": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "created_at": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}